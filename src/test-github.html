<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste GitHub Service</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #2ea043;
        }

        .error {
            color: #f85149;
        }

        .success {
            color: #3fb950;
        }

        pre {
            background: #0d1117;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <h1>üß™ Teste do GitHub Service</h1>

    <div class="test-section">
        <h2>Configura√ß√£o</h2>
        <p>Token: <input type="password" id="token"
                style="width: 300px; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; padding: 5px;"
                placeholder="ghp_..."></p>
        <p>Owner: <input type="text" id="owner" value="issei"
                style="width: 200px; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; padding: 5px;"></p>
        <p>Repo: <input type="text" id="repo" value="curriculo"
                style="width: 200px; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; padding: 5px;"></p>
    </div>

    <div class="test-section">
        <h2>Testes</h2>
        <button onclick="testValidateToken()">1. Validar Token</button>
        <button onclick="testGetFile()">2. Buscar cv.json</button>
        <button onclick="testUpdateFile()">3. Testar Update (Dry Run)</button>
        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script type="module">
        import { GitHubService } from './js/github-service.js';

        const service = new GitHubService();
        window.githubService = service;
        window.testData = {};

        window.testValidateToken = async function () {
            const token = document.getElementById('token').value;
            const results = document.getElementById('results');

            if (!token) {
                results.innerHTML = '<p class="error">‚ùå Por favor, insira um token</p>';
                return;
            }

            results.innerHTML = '<p>‚è≥ Validando token...</p>';

            try {
                const user = await service.validateToken(token);
                results.innerHTML = `
                    <p class="success">‚úÖ Token v√°lido!</p>
                    <pre>${JSON.stringify(user, null, 2)}</pre>
                `;
                window.testData.token = token;
            } catch (error) {
                results.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        };

        window.testGetFile = async function () {
            const token = document.getElementById('token').value || window.testData.token;
            const owner = document.getElementById('owner').value;
            const repo = document.getElementById('repo').value;
            const results = document.getElementById('results');

            if (!token) {
                results.innerHTML = '<p class="error">‚ùå Valide o token primeiro</p>';
                return;
            }

            results.innerHTML = '<p>‚è≥ Buscando cv.json...</p>';

            try {
                const result = await service.getFile(token, owner, repo, 'src/cv.json');
                window.testData.cvData = result.content;
                window.testData.sha = result.sha;

                results.innerHTML = `
                    <p class="success">‚úÖ Arquivo carregado!</p>
                    <p>SHA: <code>${result.sha}</code></p>
                    <p>Nome: ${result.content.Nome}</p>
                    <p>T√≠tulo: ${result.content.Titulo}</p>
                    <details>
                        <summary>Ver JSON completo</summary>
                        <pre>${JSON.stringify(result.content, null, 2).substring(0, 1000)}...</pre>
                    </details>
                `;
            } catch (error) {
                results.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`;
            }
        };

        window.testUpdateFile = async function () {
            const results = document.getElementById('results');

            if (!window.testData.cvData || !window.testData.sha) {
                results.innerHTML = '<p class="error">‚ùå Execute o teste 2 primeiro</p>';
                return;
            }

            results.innerHTML = `
                <p class="success">‚úÖ Dados prontos para update!</p>
                <p>‚ö†Ô∏è Este √© um dry-run. Para testar o update real, use a interface admin.</p>
                <p>SHA atual: <code>${window.testData.sha}</code></p>
                <p>Voc√™ pode modificar os dados e salvar via admin-editor.html</p>
            `;
        };
    </script>
</body>

</html>